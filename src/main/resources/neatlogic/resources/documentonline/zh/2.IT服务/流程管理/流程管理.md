# 流程管理
流程管理是把ITSM内的模块转换成不同的流程节点，对应的流程节点都有自己的节点特性，配置流程时，请按照业务需求灵活配置。流程管理中除了配置工作流，还支持SLA时效、通知功能、评分和步骤处理人分派策略等功能。

相关权限：[权限管理](../../100.系统配置/用户和权限.md)-IT服务-流程管理权限
## 流程图
流程图连线规则：
- 开始节点不允许连入，结束节点不允许连出。
- 流程必须从起始节点（绿色节点）出发，结束节点（红色节点）终止，开始和结束节点无意义。
- 除起始和结束节点，其他节点不能孤立存在，必须有连入和连出的线。
- 开始节点后面只能连接普通节点和创建变更节点。

![](images/绘制流程图.gif)

## 流程节点
流程节点包括分流、条件、通用节点、事件、变更创建、变更处理、自动处理、数据转换、自动化、定时节点等节点。

### 分流节点
连接作用的节点，分流节点不用处理，流转到该节点同时激活与分流节点相连的后置节点。
![](images/分流节点.png)

### 条件节点
有条件判断的连接节点，条件节点不用处理，流转到该节点时，同时激活匹配到的条件的流转节点。
![](images/条件节点.png)

### 通用节点
包括所有的基础节点功能，通用节点要处理才能流转，只能选一条流转路径并激活后置节点。
![](images/通用节点.png)

### 变更创建节点
创建变更步骤的节点，与变更处理节点成对存在，不能有独立的变更创建节点。

### 变更处理节点
处理变更步骤的节点，必须关联变更创建节点，一个变更创建节点只能引用一次。
![](images/变更节点.png)

### 事件节点
处理事件的节点。
![](images/事件节点.png)

### 自动处理节点
引用集成管理的集成配置接口，流转到该节点时自动向配置的接口发起请求。
![](images/自动处理节点.png)

### 审批节点
发起审批流的节点，必须关联EOA模板。工单流转到该节点时，只能节点关联其中一个模板。
![](images/审批节点.png)
- 自动创建签报
这个设置启用后，必须同时满足三个条件才能生效，分别是“节点处理人唯一”、“审批模板唯一”、“所有审批步骤已设置好审批人”
![](images/审批节点_自动创建签报.png)

- EOA模板
EOA模板即审批流模板，模板可多选，创建签报时，只能在审批节点已关联的模板中选择一个来发起审批。

- 审批人
审批模板是由多个审批步骤组成，每个步骤都有相应的审批人，审批人可以提前设置，模板中预设的审批人无法修改，如果不预设审批人，可以在工单发起审批时选择审批人。
![](images/审批节点_审批人.png)

### 数据转换节点
数据转换节点是用来把表单数据同步到配置模型[配置模型](../../3.配置管理/模型管理/模型管理.md)，包括新增和修改配置项，唯一规则属性匹配到已存在的配置项，就会执行修改配置操作。
- 回退重新同步
  
  启用这个配置后，当工单回退到前置节点，重新激活数据转换节点时，会再次执行同步操作。

- 失败策略
  
  数据转换节点同步配置项失败后自动执行的策略，包括人工处理和向后流转，人工处理是指由节点处理人处理，向后流转即自动流转到下一步骤。

- 模型映射配置
  
  配置写入模型及关系模型
  ![](images/数据转换_写入模型及关系模型.png)

  模型数据写入的同步策略有两种，全局和局部。同步策略对新增配置项没有影响，修改配置项才有差异。

  全局：更新配置项的全量数据，属性的映射值对比配置项属性原来的值有差异，修改对应属性的数据；映射值为空的属性，删除对应属性的数据。<br>
  局部：更新配置项的局部数据，属性的映射值对比配置项属性原来的值有差异，则修改对应属性的数据；映射值为空的属性不做修改。

  配置项写入数量包括两种场景，一条和多条，写入多条配置项时，需要定义遍历对象，只支持表格输入组件。
  ![](images/数据转换_配置项数量.jpg)
  如果关系模型也是添加多条时，需要配置两个模型遍历表格组件的关联属性的表达式。
  ![](images/数据转换_关联表格.png)
  映射表单普通组件<br>
  表单普通组件是指除表格输入组件以外其他组件，添加一条数据或添加多条数据都支持映射表单普通组件，直接选择表单的普通组件即可，映射的对象格式要和模型属性一致。
  ![](images/CMDB同步节点_映射表单普通组件.png)
  注意：下拉框类型模型属性映射的表单组件的数据源必须是配置项类型矩阵，表单组件选项的值要映射配置项ID，且矩阵与下拉框模型属性引用的是同一个模型。
  ![](images/CMDB同步节点_下拉框组件映射要求.png)
  映射表单表格组件<br>
  同步多条数据时，选择遍历的表格输入组件，配置模型属性支持映射表单表格组件的属性值。配置项属性映射时，会过滤出遍历的表单表格组件的所有属性。
  ![](images/CMDB同步节点_映射表格输入组件.png)
  

### 自动化节点
自动化节点是结合自动化模块的节点，关联自动化模块的组合工具，并配置参数映射，通过工单节点发起自动化作业。
![](images/自动化节点.png)

### 定时节点
定时节点是定时自动处理的节点，必须关联表单中必填的日期组件使用，该节点无法人工处理，当系统时间达到日期组件的时间，自动流转到后置节点。
![](images/定时节点.png)

## 流程设置
流程设置时作用于整个流程阶段的，包括流程名称、关联表单、权限设置、通知设置、动作设置、标记重复事件。
![](images/流程设置.png)

- 权限设置<br>
包括了取消、修改上报内容、催办权限，未启用则默认所有用户都无这三个权限，启用后，仅授权对象有权限。取消是指取消工单，修改上报内容是指修改标题、优先级、上报描述、附件等工单信息，催办是指催办工单。

- 通知设置<br>
启用后，需要引用 [通知策略管理](../../100.系统配置/通知策略管理.md)-IT服务-工单 的模板；若不启用，则引用“通知策略管理-IT服务-工单”的默认模板。

- 动作设置<br>
满足在工单操作时需要触发调用外部接口的场景，外部接口配置来源于[集成管理](../../100.系统配置/集成管理.md)。
![](images/流程设置_动作设置.gif)

- 标记重复事件<br>
发起重复的工单，可通过关联重复工单，来关闭其他重复的工单。

## 节点设置
点击节点图标，打开相应节点的节点设置。

### 表单场景
表单场景有默认场景和自定义场景，若未修改，默认选择默认场景。
![](images/节点设置_表单场景.png)

### 权限设置
节点权限包括查看节点信息、转交、暂停、撤回权限。查看节点信息是指查看步骤详情中对应节点的信息，转交是指将工单当前节点处理权限转给其他用户，暂停是指暂停处理当前节点，撤回是指撤回到上一处理节点。

### 通知设置
通知设置默认引用全局，启用自定义后，需关联流程步骤模块的通知策略，关联通知策略后，可自定义通知策略中触发时机和参数的映射。参数支持选择流程属性、表单组件，也支持输入常量。

### 动作设置
节点的动作设置与流程设置中的一致，只是触发点不同。

### 重审
重审是指回退后一键处理并流转到回退前的节点，所以启用重审的节点应该有连入的回退线，才是有效设置。
![](images/节点设置_重审.png)

### 文案修改
未启用时，默认引用全局设置；启用修改文案后，可修改工单按钮、节点状态以及详情页页签标题的文案。
![](images/节点设置_修改文案.gif)

### 自动开始
自动开始设置是应用于节点只分派到一个处理人的场景，节点可自动开始处理。

### 自动流转
节点启用自动流转，当工单处理到该节点时，系统自动流转，不需要人工处理。

### 回复必填
启用回复必填，工单处理该节点时，校验回复必填，回复为空无法流转。

### 默认回复
节点配置默认回复模板，模板来自[回复模板管理](../其他配置管理/配置管理.md)，处理工单对应节点时，回复框自动填充默认回复模板内容。默认回复的生效有条件，处理人有默认回复模板的权限才能生效。
![](images/节点设置_回复模板.png)

### 创建子任务
配置了[子任务策略](../其他配置管理/配置管理.md)的节点，工单处理时，支持添加子任务。
![](images/节点设置_创建子任务.gif)

### 分配处理人
节点分配处理人的策略：前置步骤处理人指定、复制前置步骤处理人、表单值、分派器、自定义分派策略。 匹配方式支持全部匹配和顺序匹配。全部匹配的对象是指匹配成功的策略分配到的所有用户，顺序匹配的对象是指按顺序匹配到的第一个匹配成功的策略所分配的用户。

1. 由前置步骤处理人指定：前置步骤流转时可指定当该节点的处理人，此策略需关联前置步骤。

2. 复制前置步骤处理人：工单流转至节点时，会复制关联的前置节点的处理人作为处理人，此策略需关联前置步骤。

3. 表单值：需关联映射的表单组件，只支持用户选择器和下拉框组件，其中下拉框组件只有引用矩阵中的用户类型属性时才能匹配成功。

4. 分派器：需关联分派器，工单流转至节点时，会根据分派器的分派逻辑自动指定处理人，以CMDB分派器为例。
  
    CMDB分派器：支持用通过模型或者视图的属性和表单组件做映射，将匹配到的用户、分组、角色作为节点待处理人。

    配置包括数据类型、数据来源、匹配映射、处理人和优先级。匹配映射的关键点在于，[表单](../../100.系统配置/表单管理.md)的组件必须引用[配置项矩阵](../../100.系统配置/矩阵管理.md)，且矩阵引用的配置模型与匹配映射的属性是同一个。
    ![](images/CMDB分派器-示例.png)

    注意：当匹配到的配置项不唯一，或匹配到唯一对象，但系统不存在该对象，CMDB分派器无法生效，将自动分配给节点的异常处理人。

5. 自定义：直接选择分派对象，分派对象支持上报人、代报人、用户、角色和分组。
   ![](images/节点设置_分配处理人.gif)

### 异常处理人
异常处理人是节点分配处理人异常时才生效，节点自动分配给异常处理人，异常处理人必填。
  
## 时效设置
添加时效策略步骤：点击添加时效策略--配置时效--保存时效
![](images/节点设置_时效设置.gif)

## 评分设置
评分设置步骤：启用评分-选择[评分模板](../其他配置管理/配置管理.md)、配置自动评分
流程启用评分设置后，结束节点支持拉回退线到前置节点，未启用评分，则结束节点不支持回退。
![](images/节点设置_评分设置.png)
